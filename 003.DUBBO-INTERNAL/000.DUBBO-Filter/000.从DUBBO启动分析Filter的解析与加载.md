# 从DUBBO启动分析Filter的解析与加载
启动堆栈如下: 
```shell
buildInvokerChain(Invoker, String, String):45, DefaultFilterChainBuilder (org.apache.dubbo.rpc.cluster.filter), DefaultFilterChainBuilder.java # 构建调用责任链 , 见代码&注释
export(Invoker):61, ProtocolFilterWrapper (org.apache.dubbo.rpc.cluster.filter), ProtocolFilterWrapper.java
export(Invoker):50, ProtocolSerializationWrapper (org.apache.dubbo.rpc.protocol), ProtocolSerializationWrapper.java
export(Invoker):42, InvokerCountWrapper (org.apache.dubbo.rpc.protocol), InvokerCountWrapper.java
export(Invoker):-1, Protocol$Adaptive (org.apache.dubbo.rpc), Protocol$Adaptive.java
doExportUrl(URL, boolean, RegisterTypeEnum):969, ServiceConfig (org.apache.dubbo.config), ServiceConfig.java
exportLocal(URL):986, ServiceConfig (org.apache.dubbo.config), ServiceConfig.java
exportUrl(URL, List, RegisterTypeEnum):860, ServiceConfig (org.apache.dubbo.config), ServiceConfig.java
doExportUrlsFor1Protocol(ProtocolConfig, List, RegisterTypeEnum):622, ServiceConfig (org.apache.dubbo.config), ServiceConfig.java
doExportUrls(RegisterTypeEnum):600, ServiceConfig (org.apache.dubbo.config), ServiceConfig.java
doExport(RegisterTypeEnum):555, ServiceConfig (org.apache.dubbo.config), ServiceConfig.java
export(RegisterTypeEnum):343, ServiceConfig (org.apache.dubbo.config), ServiceConfig.java
exportServiceInternal(ServiceConfigBase):495, DefaultModuleDeployer (org.apache.dubbo.config.deploy), DefaultModuleDeployer.java
exportServices():442, DefaultModuleDeployer (org.apache.dubbo.config.deploy), DefaultModuleDeployer.java
startSync():177, DefaultModuleDeployer (org.apache.dubbo.config.deploy), DefaultModuleDeployer.java
start():159, DefaultModuleDeployer (org.apache.dubbo.config.deploy), DefaultModuleDeployer.java
startModules():771, DefaultApplicationDeployer (org.apache.dubbo.config.deploy), DefaultApplicationDeployer.java
doStart():735, DefaultApplicationDeployer (org.apache.dubbo.config.deploy), DefaultApplicationDeployer.java
start():708, DefaultApplicationDeployer (org.apache.dubbo.config.deploy), DefaultApplicationDeployer.java
start(boolean):230, DubboBootstrap (org.apache.dubbo.config.bootstrap), DubboBootstrap.java
start():219, DubboBootstrap (org.apache.dubbo.config.bootstrap), DubboBootstrap.java
startWithBootstrap():49, Application (org.apache.dubbo.sentinel.provider), Application.java
main(String[]):34, Application (org.apache.dubbo.sentinel.provider), Application.java
```
- 通过调用堆栈&源代码,可以发现:
  + 调用链的构建是在应用启动的时候
  + Filter通过SPI机制来实现的，方便拓展


## 实现自己的Dubbo Filter
1. 实现Filter:[DubboSTUFilter](../../001.SOURCE_CODE/000.DUBBO-3.3.2-RELEASE/000.DUBBO-3.3.2-RELEASE/dubbo-demo/dubbo-demo-sentinel/dubbo-demo-sentinel-provider/src/main/java/org/apache/dubbo/sentinel/provider/filter/DubboSTUFilter.java)
    + 需要使用注解: @Activate(group = PROVIDER)
2. 配置SPI机制: 按照路径配置:[META-INF/dubbo/org.apache.dubbo.rpc.Filter](../../001.SOURCE_CODE/000.DUBBO-3.3.2-RELEASE/000.DUBBO-3.3.2-RELEASE/dubbo-demo/dubbo-demo-sentinel/dubbo-demo-sentinel-provider/src/main/resources/META-INF/dubbo/org.apache.dubbo.rpc.Filter) 需要注意路径: META-INF/dubbo/org.apache.dubbo.rpc.Filter (纯文本文件)
   - 一定得是 org.apache.dubbo.rpc.Filter , 详见[org.apache.dubbo.common.extension.ExtensionLoader#loadDirectory](../../001.SOURCE_CODE/000.DUBBO-3.3.2-RELEASE/000.DUBBO-3.3.2-RELEASE/dubbo-common/src/main/java/org/apache/dubbo/common/extension/ExtensionLoader.java)代码注释
3. 通过上述堆栈，可以了解到SPI加载流程


